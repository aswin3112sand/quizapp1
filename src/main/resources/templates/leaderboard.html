<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Aswin Quiz â€“ Leaderboard')}"></head>
<body data-bs-theme="dark" class="page-leaderboard">
  <img src="/img/bg1.jpg" th:src="@{/img/bg1.jpg}" class="bg-img bg1" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg2.jpg" th:src="@{/img/bg2.jpg}" class="bg-img bg2" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg3.jpg" th:src="@{/img/bg3.jpg}" class="bg-img bg3" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg4.jpg" th:src="@{/img/bg4.jpg}" class="bg-img bg4" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg5.jpg" th:src="@{/img/bg5.jpg}" class="bg-img bg5" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg6.jpg" th:src="@{/img/bg6.jpg}" class="bg-img bg6" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg7.jpg" th:src="@{/img/bg7.jpg}" class="bg-img bg7" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg8.jpg" th:src="@{/img/bg8.jpg}" class="bg-img bg8" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg9.jpg" th:src="@{/img/bg9.jpg}" class="bg-img bg9" alt="" loading="lazy" decoding="async" />
  <img src="/img/bg10.jpg" th:src="@{/img/bg10.jpg}" class="bg-img bg10" alt="" loading="lazy" decoding="async" />

  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <main class="container py-5">
    <section class="glass card-premium leaderboard-card" data-reveal="up">
      <div class="d-flex justify-content-between flex-wrap gap-3 align-items-center mb-3">
        <div>
          <p class="badge-soft mb-1">Live sync</p>
          <h1 class="h4 mb-0">Leaderboard</h1>
          <small class="text-muted" th:text="${quiz.title}">Quiz name</small>
        </div>
        <span class="text-muted small">Updates auto via WebSocket</span>
      </div>
      <ul id="leaderboard" class="list-group list-group-flush bg-transparent"></ul>
    </section>
  </main>

  <script src="../static/js/app.js" th:src="@{/js/app.js}" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <script>
    const socket = new SockJS('/ws');
    const stomp = Stomp.over(socket);
    stomp.debug = () => {};
    const list = document.getElementById('leaderboard');
    function render(items){
      list.innerHTML = '';
      if(items.length === 0){
        const li = document.createElement('li');
        li.className = 'list-group-item bg-transparent text-white';
        li.textContent = 'No results yet';
        list.appendChild(li);
        return;
      }
      items.forEach((r, idx) => {
        const li = document.createElement('li');
        li.className = 'list-group-item bg-transparent text-white d-flex justify-content-between align-items-center';
        li.innerHTML = `<span>#${idx+1} - ${r.displayName}</span>
          <span><b>${r.score}</b> / ${r.total} <small class="text-secondary ms-2">${r.submittedAt}</small></span>`;
        list.appendChild(li);
      });
    }
    function loadInitial() {
      fetch('/api/leaderboard')
        .then(resp => resp.json())
        .then(render)
        .catch(() => render([]));
    }
    loadInitial();
    stomp.connect({}, () => {
      stomp.subscribe('/topic/leaderboard', (msg) => {
        const data = JSON.parse(msg.body);
        render(data);
      });
    });
  </script>
  <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
